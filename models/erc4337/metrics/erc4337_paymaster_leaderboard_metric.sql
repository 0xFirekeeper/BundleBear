{{ config
(
    materialized = 'table',
    copy_grants=true
)
}}

SELECT 
CHAIN,
PAYMASTER_NAME,
COUNT(*) AS NUM_USEROPS,
SUM(ACTUALGASCOST_USD) AS GAS_SPENT
FROM BUNDLEBEAR.DBT_KOFI.ERC4337_ALL_USEROPS
WHERE PAYMASTER != '0x0000000000000000000000000000000000000000'
AND ACTUALGASCOST_USD != 'NaN'
AND ACTUALGASCOST_USD < 1000000000
GROUP BY 1,2

UNION ALL
SELECT 
'all' AS CHAIN,
PAYMASTER_NAME,
COUNT(*) AS NUM_USEROPS,
SUM(ACTUALGASCOST_USD) AS GAS_SPENT
FROM BUNDLEBEAR.DBT_KOFI.ERC4337_ALL_USEROPS
WHERE PAYMASTER != '0x0000000000000000000000000000000000000000'
AND ACTUALGASCOST_USD != 'NaN'
AND ACTUALGASCOST_USD < 1000000000
GROUP BY 1,2